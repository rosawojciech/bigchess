test_that("san2lan correctly converts SAN to LAN", {
  expect_equal(san2lan("1. e4 e5 2. Nf3 Nf5 3. d5"), "e2e4 e7e5 g1f3 g8f5 d2d5")
  expect_equal(san2lan("1. e4 c5 2. Nf3 d6 3. d4"), "e2e4 c7c5 g1f3 d7d6 d2d4")
})

test_that("san2lan handles empty input", {
  expect_equal(san2lan(""), "")
})

test_that("san2lan handles non-standard input", {
  expect_error(san2lan("This is not a valid input"))
})

test_that("previous bug is gone", {
  movetext <- "1. b4 b5 2. Nc3 Bb7 3. a4 Nc6 4. Ba3 Rb8 5. h3 g6 6. h4 Nh6 7. Nf3 e5 8. Rb1 e4 9. Nh2 Ng8 10. Nf3 Nf6 11. d3 Ne5 12. Rg1 Bd6 13. g4 exf3 14. Rb3 Nh5 15. exf3 Qf6 16. Qc1 Ng7 17. Qd1 Qe7 18. f4 Bxb4 19. Rxb4 d6 20. axb5 Ra8 21. Qb1 Rc8 22. f3 Qd7 23. Rc4 Ke7 24. Nd5+ Kd8 25. Ra4 a5 26. Nb6 Nh5 27. Nxc8 Nxf3+ 28. Kf2 d5 29. Rd4 Ne5 30. Nd6 Qe8 31. Bc5 Kd7 32. Ra4 Qf8 33. Qb3 Qg8 34. Kg2 f6 35. Ra1 g5 36. Bf2 Qa8 37. Nc8 Kd8 38. Kh1 Qa7 39. Rc1 Qe3 40. Kg2 a4 41. Bxe3 Nxf4+ 42. Bxf4 axb3 43. b6 Nc4 44. Kh1 Nxb6 45. Be5 Kxc8 46. Rg3 Ba6 47. Bc3 bxc2 48. h5 h6 49. Bb4 c6 50. Rb1 cxb1=B 51. Ba3 Na4 52. Rf3 Bb7 53. Rxf6 d4 54. Bb2 Nb6 55. Kg2 Bc2 56. Ba3 Kd8 57. Rf7 Rf8 58. Bb2 Bxd3 59. Re7 Na8 60. Bc3 Bb5 61. Bd3 Rf3 62. Be2 Bc8 63. Ba5+ Kxe7 64. Bb4+ Kd7 65. Kh1 Bb7 66. Ba3 Nb6 67. Bxb5 Ke8 68. Be7 Rf5 69. Bf8 Rf7 70. Bf1 Nd7 71. Bd6 Rf2 72. Kg1 Rb2 73. Be2 Nf8 74. Bb8 Ba8 75. Kh2 Rxb8 76. Bd1 Rb4 77. Kh3 Kd7 78. Kg3 Rb5 79. Bf3 Kd8 80. Be2 Rb8 81. Kg2 Rb3 82. Bd1 Rb4 83. Be2 c5+ 84. Kg1 Rc4 85. Bd3 Be4 86. Bxe4 Kc7 87. Bc6 Rc2 88. Bf3 Ne6 89. Kh1 Rg2 90. Bb7 Kd6 91. Bxg2 c4 92. Bc6 Ke5 93. Be8 Nc5 94. Bb5 c3 95. Bc6 Na6 96. Bd5 Kd6 97. Bb3 d3 98. Kg1 Ke7 99. Be6 Nc7 100. Kg2 Kf6 101. Bf7 Ke5 102. Be6 Kd4 103. Kh1 Nxe6 104. Kg2 Nf8 105. Kf3 Kd5 106. Kf2 Ke4 107. Ke1 Kd4 108. Kf2 Nh7 109. Kg1 Nf8 110. Kf1 Nd7 111. Kg2 Ne5 112. Kh3 d2 113. Kg3 d1=N 114. Kg2 Ke3 115. Kg3 Nd3 116. Kh2 N1b2 117. Kg1 Kf3 118. Kf1 Nb4 119. Kg1 Kf4 120. Kf1 Na2 121. Ke2 Nd1 122. Kd3 Nf2+ 123. Kc2 Nd1 124. Kb3 Ke3 125. Ka4 Nc1 126. Kb4 Kf3 127. Kc5 Na2 128. Kc4 Ke2 129. Kd4 Nc1 130. Kc5 c2 131. Kd4 Nc3 132. Kc5 Na4+ 133. Kc6 Kd1 134. Kd6 Na2 135. Ke5 c1=Q 136. Ke6 Qa1 137. Kf7 Nc5 138. Kg6 Nc1 139. Kf7 N5d3 140. Ke7 Na2 141. Ke8 Qe5+ 142. Kf7 Qd4 143. Ke6 Qa4 144. Kf5 Ne1 145. Kg6 Nf3 146. Kf5 Kd2 147. Kf6 Qa5 148. Ke6 Nh2 149. Ke7 Qc3 150. Kd7 Qa1 151. Ke6 Qc1 152. Kf7 Qf1+ 153. Kg8 Ke1 154. Kh7 Qd3+ 155. Kxh6 Qd2 156. Kg7 Nf3 157. Kh8 Kf1 158. Kh7 Qg2 159. Kg8 Ke1 160. Kh8 Qc2 161. Kg8 Qg2 162. Kf8 Qe2 163. h6 Nd4 164. h7 Qd2 165. Kg8 Qc2 166. h8=R Nb5 167. Rh1+ Kf2 168. Kh8 Nc7 169. Rh2+ Kf3 170. Rd2 Qa4 171. Rd6 Qa7 172. Ra6 Qf2 173. Kg7 Qe1 174. Ra3+ Nc3 175. Kh8 Qe7 176. Ra7 Qe4 177. Kg7 Qf5 178. Ra3 Qe6 179. Ra7 Qd6 180. Ra5 Qf4 181. Ra8 Kg3 182. Kh6 Kh3 183. Rg8 Qf7 184. Rb8 Qg6+ 185. Kxg6 N7b5 186. Rg8 Kh2 187. Rc8 Nc7 188. Rd8 Nd1 189. Kf5 Ne6 190. Rd4 Nd8 191. Kxg5 Nc3 192. Kh6 Nd5 193. Rd2+ Kh3 194. Rd4 Kh4 195. Kg7 Ne3 196. Kf6 Kg3 197. Rd5 Ng2 198. Re5 Nh4 199. Re7 Nb7 200. Re8 Nf5 201. Re4 Nc5 202. Re3+ Kf2 203. Kf7 Ne6 204. Kg6 Nxe3 205. Kh6 Nf1 206. Kh5 Ke1 207. Kg6 Nd8 208. Kg7 Nf7 209. Kxf7 Kd1 210. Kf6 Ke2 211. Kg6 Nh2 212. Kh7 Ke3 213. Kg6 Nf1 214. Kg5 Nh2 215. Kh5 Kf4 216. g5 Ng4 217. g6 Nf6+ 218. Kh4 Ke4 219. g7 Nd7 220. Kh3 Kf4 221. Kh4 Kf3 222. Kh5 Nb6 223. g8=R Nd5 224. Rb8 Nf6+ 225. Kg5 Ng8 226. Rb2 Kg3 227. Rb7 Ne7 228. Kf6 Kf2 229. Kg7 Nd5 230. Rf7+ Kg3 231. Rc7 Kh2 232. Kg6 Nxc7"
  expect_equal(class(san2lan(movetext)), "character")
  movetext <- "1. Nh3 e6 2. b3 g5 3. Nxg5 f6 4. Nc3 Qe7 5. Bb2 Qd8 6. Qc1 c5 7. Kd1 fxg5 8. Nb1 d6 9. g4 Qa5 10. Be5 Ne7 11. Ke1 Bh6 12. b4 d5 13. d4 Nd7 14. Bb8 e5 15. e4 Rxb8 16. Kd2 c4 17. Kd1 Rg8 18. Nc3 Kf7 19. Qe3 Qb6 20. h3 Qa5 21. a4 b5 22. Kd2 Kg6 23. f3 Re8 24. Ne2 Rb7 25. Qf2 a6 26. Qh4 Nf6 27. Rh2 Qb6 28. Qxg5+ Kf7 29. Ke1 Nd7 30. Qg7+ Kxg7 31. exd5 Bf4 32. a5 Rf8 33. Kf2 Nb8 34. Rc1 h5 35. Rb1 Rf6 36. Ke1 h4 37. Nc3 Bxh2 38. dxe5 Rg6 39. Be2 Qe3 40. Nxb5 Qg1+ 41. Kd2 Kh7 42. f4 Kh8 43. Bf3 Nf5 44. Rd1 Rxg4 45. Be4 Ne3 46. Rf1 Rbg7 47. c3 Bf5 48. Rb1 R7g5 49. Ra1 Qf1 50. Nd6 Qb1 51. Bf3 Bg1 52. Be2 Bc2 53. Ra3 Bf2 54. Ra1 Rg7 55. Ra3 Ra7 56. f5 Be1+ 57. Kxe3 Rag7 58. e6 Bd1 59. Bxd1 Rb7 60. b5 Qe4+ 61. Nxe4 axb5 62. Ra2 Bg3 63. Ke2 Rg8 64. d6 Nc6 65. Rc2 Rh7 66. Kf3 Rgg7 67. Nxg3 Rxg3+ 68. Ke2 Nb8 69. Rc1 Kg7 70. a6 Nc6 71. Ke1 Rxh3 72. Kf2 Rxc3 73. Bg4 Rh6 74. d7 Ra3 75. Bf3 Rg6 76. Rh1 Kh6 77. Rh2 Nb4 78. d8=N Kg5 79. a7 Kf4 80. a8=R Rg7 81. Bh5 Rb7 82. Rxh4+ Kg5 83. Be2 Rg3 84. Bh5 Rb3 85. Ra4 Rc3 86. Ke1 Nc6 87. Kd2 Rd3+ 88. Kc2 bxa4 89. Bf7 Na5 90. Rh1 Kf6 91. Rh2 Re3 92. e7 Re6 93. Kc3 Reb6 94. Kd4 Ra6 95. Rh5 Re6 96. Bg6 Rd6+ 97. Kc5 Re6 98. Rh3 Kg5 99. Rf3 Rbxe7 100. Bf7 Rc6+ 101. Kd5 Kh4 102. Bg6 Rce6 103. Nb7 c3 104. Rh3+ Kg5 105. Nd8 Re1 106. Rf3 Nc4 107. Rf1 Ne5 108. Bh5 c2 109. Rh1 Re4 110. Ne6+ Kf6 111. Kc5 Rd7 112. Be2 Rh4 113. Ng7 Nd3+ 114. Kc6 Rh8 115. Rh4 Rdd8 116. Rc4 Rhg8 117. Nh5+ Ke5 118. Nf6 Rge8 119. Rh4 c1=B 120. Nd5 a3 121. Kb5 Re6 122. Rd4 a2 123. Rxd3 Ra6 124. Nf4 Rd5+ 125. Kc4 Ra3 126. Rd2 Rg3 127. Rc2 Kd6 128. f6 a1=Q 129. Kb4 Rc3 130. Nxd5 Rf3 131. Rb2 Kc6 132. Bb5+ Kxd5 133. Ba6 Bf4 134. Rh2 Qe5 135. Rb2 Bd2+ 136. Ka4 Kc5 137. Bb7 Qf4+ 138. Be4 Bb4 139. f7 Ba3 140. f8=Q+ Qd6 141. Qe8 Qb6 142. Rxb6 Rf1 143. Rd6 Rb1 144. Bg6 Kxd6 145. Be4 Rc1 146. Bb7 Rd1 147. Qh8 Ra1 148. Be4 Rb1 149. Bg6 Rh1 150. Qh6 Rb1 151. Qh5 Rf1 152. Bc2 Ke7 153. Bh7 Kd7 154. Bg6 Rd1 155. Qh4 Bd6 156. Qg4+ Kc7 157. Qf4 Ra1+ 158. Kb5 Rg1 159. Be4 Be5 160. Bb7 Kd8 161. Qxe5 Rg7 162. Qd6+ Rd7 163. Kc6 Ke8 164. Qg6+ Kf8 165. Qh6+ Ke8 166. Qd2 Rg7 167. Qg2 Rg4 168. Qf2 Ke7 169. Qf3 Rd4 170. Qd1 Rb4 171. Qb1 Ke6 172. Qc2 Rb5 173. Qb1 Rd5 174. Bc8+ Ke5 175. Qc1 Rc5+ 176. Kb6 Kf6 177. Qd2 Rg5 178. Be6 Ra5 179. Kb7 Ke5 180. Bd7 Ra1 181. Bg4 Rg1 182. Bc8 Rf1 183. Kb8 Rg1 184. Qg5+ Rxg5 185. Ba6 Rg3 186. Be2 Rc3 187. Ba6 Rc5 188. Ka7 Rc7+ 189. Kb8 Kf5 190. Be2 Rc4 191. Bg4+ Kf4 192. Bc8 Kg5 193. Ka7 Rf4 194. Ka8 Ra4+ 195. Ba6 Rg4 196. Ka7 Rc4 197. Bc8 Kg6 198. Ka8 Rc3 199. Ka7 Kg5 200. Bg4 Rb3 201. Bc8 Rd3 202. Ka6 Kg6 203. Kb6 Rd8 204. Kc7 Kf7 205. Kc6 Rxc8+ 206. Kb5 Ra8 207. Kc5 Ra4 208. Kd5 Rf4 209. Kc6 Kg7 210. Kd5 Kg6 211. Kc6 Kg5 212. Kb5 Kh5 213. Ka6 Ra4+ 214. Kb6 Kg4 215. Kc5 Kf4 216. Kb6 Kf5 217. Kb5 Re4 218. Kb6 Re2 219. Kb5 Ke6 220. Kb6 Re5 221. Kc6 Kf7 222. Kd6 Re8 223. Kc6 Rg8 224. Kd6 Kg7 225. Kc5 Rd8 226. Kb6 Rh8 227. Ka6 Kf7 228. Ka5 Rd8 229. Kb5 Ke7 230. Kb4 Rd7 231. Kc5 Rc7+ 232. Kd5 Kd7 233. Ke4 Kd6 234. Kf5 Rc6 235. Kf4 Rc2 236. Kf5 Kd5 237. Kg4 Ke4 238. Kh3 Rc7 239. Kg4 Rh7 240. Kg3 Rc7 241. Kh2 Kf4 242. Kg2 Rc6 243. Kh2 Rd6 244. Kh3 Kg5 245. Kg3 Rd8 246. Kg2 Rd3 247. Kh1 Rh3+ 248. Kg1 Kg4 249. Kf2 Rf3+ 250. Ke2 Kg3 251. Kd1 Kh2 252. Ke2 Rh3 253. Kf2 Re3 254. Kf1 Rc3 255. Ke1 Kg2"
  expect_equal(class(san2lan(movetext)), "character")
})
